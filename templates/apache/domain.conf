# WebStack CLI - Apache Domain Template
# Variables: {{.Domain}}, {{.DocumentRoot}}, {{.PHPVersion}}

<VirtualHost *:8080>
    ServerName {{.Domain}}
    DocumentRoot {{.DocumentRoot}}
    
    # Logging
    CustomLog /var/log/apache2/{{.Domain}}.access.log combined
    ErrorLog /var/log/apache2/{{.Domain}}.error.log
    LogLevel warn

    # Directory settings
    <Directory {{.DocumentRoot}}>
        AllowOverride All
        Options +Includes -Indexes +ExecCGI
        Require all granted
        
        # PHP configuration
        <IfModule mod_php{{.PHPVersion}}.c>
            php_admin_value open_basedir {{.DocumentRoot}}:/tmp
            php_admin_value upload_tmp_dir /tmp
            php_admin_value session.save_path /tmp
            php_admin_value sys_temp_dir /tmp
        </IfModule>
    </Directory>

    # Security
    <Files ".ht*">
        Require all denied
    </Files>
    
    <Files "*.ini">
        Require all denied
    </Files>
    
    <Files "*.log">
        Require all denied
    </Files>

    # Error pages
    Alias /error/ /usr/share/apache2/error/
    <Directory "/usr/share/apache2/error/">
        AllowOverride None
        Options IncludesNoExec
        AddOutputFilter Includes html
        Require all granted
    </Directory>

    # Set real IP from Nginx proxy
    <IfModule mod_remoteip.c>
        RemoteIPHeader X-Real-IP
        RemoteIPTrustedProxy 127.0.0.1
    </IfModule>
</VirtualHost>