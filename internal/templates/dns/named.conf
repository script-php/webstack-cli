// This is the primary configuration file for the BIND DNS server named.
// Generated by WebStack CLI - Bind9 DNS Manager

// Enable logging
logging {
    channel default_log {
        file "/var/log/named/default.log" versions 3 size 5m;
        severity dynamic;
        print-time yes;
        print-severity yes;
        print-category yes;
    };
    category default { default_log; };
    category queries { default_log; };
};

// ACLs for clustering and replication
acl "internals" {
    127.0.0.1;
    ::1;
    {{.ServerIP}};
{{if and (eq .Mode "master") (ne .MasterIP "")}}
    {{.MasterIP}};
{{end}}
};

acl "slaves" {
    // Slave servers will be added here
    // Format: IP_ADDRESS;
};

options {
    // Listen addresses
    listen-on port 53 { any; };
    listen-on-v6 port 53 { any; };

    // Directory configuration
    directory "/var/lib/bind";
    
    // Security
    auth-nxdomain no;
    allow-transfer { internals; slaves; };
    allow-recursion { internals; 127.0.0.1; };
    
    // Performance tuning
    recursive-clients 1000;
    tcp-clients 100;
    
    // DNSSEC
    dnssec-validation auto;
    
    // Query logging (optional, disable for production)
    querylog no;
    
    // Clustering and replication
    notify {{if eq .Mode "master"}}yes{{else}}no{{end}};
    allow-update { none; };
    
{{if eq .Mode "slave"}}
    // Slave mode configuration
    zone-statistics yes;
    transfer-source {{.ServerIP}};
    transfer-source-v6 {{.ServerIP}};
{{else}}
    // Master mode configuration
    zone-statistics yes;
{{end}}
};

// Load default zones (root, localhost, reverse zones, etc.)
include "/etc/bind/named.conf.default-zones";

// Load zone configurations
include "/etc/bind/named.conf.local";

// Clustering configuration (if part of a cluster)
{{if ne .ClusterName ""}}
// Cluster: {{.ClusterName}}
// Master synchronization enabled
key "cluster-key-{{.ClusterName}}" {
    algorithm hmac-sha256;
    secret "{{.ClusterName}}-key-base64-encoded";
};
{{end}}
